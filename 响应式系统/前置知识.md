# å‰ç½®çŸ¥è¯†
`Vue.js`æ˜¯é€šè¿‡æ•°æ®åŠ«æŒ + å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼æ¥å®ç°å“åº”å¼åŠŸèƒ½çš„ã€‚

## Object.defineProperty

> `Object.defineProperty()` æ–¹æ³•ä¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œ å¹¶è¿”å›è¿™ä¸ªå¯¹è±¡ã€‚

é€šè¿‡`Object.defineProperty()`ç»™æŸä¸ªå±æ€§è®¾ç½®getå’Œsetå°±å¯ä»¥åŠ«æŒè¯¥å±æ€§çš„è¯»å†™è¿‡ç¨‹ï¼Œå…·ä½“çš„apiä½¿ç”¨æˆ‘ä»¬ä¸å±•å¼€ï¼ˆ[MDNä¼ é€é—¨](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty)ï¼‰ï¼Œç°åœ¨ä½¿ç”¨`Object.defineProperty`å†™ä¸ªç®€å•çš„å°demoï¼Œæ¥åŠ«æŒä¸€ä¸ªå¯¹è±¡çš„å±æ€§èµ‹å€¼å’Œå–å€¼è¿‡ç¨‹ğŸ‘‡
```js
function Store() {
    let data = null;
    Object.defineProperty(this, 'data', {
        get: function() {
            console.log('æ‹¦æˆªåˆ°äº†ï¼Œä½ åœ¨è¯»å–æ•°æ®'); // æ‹¦æˆªåˆ°äº†ï¼Œä½ åœ¨è¯»å–æ•°æ®
            return data;
        },
        set: function(val) {
            console.log('æ‹¦æˆªåˆ°äº†ï¼Œä½ åœ¨è®¾ç½®æ•°æ®'); // æ‹¦æˆªåˆ°äº†ï¼Œä½ åœ¨è®¾ç½®æ•°æ®
            data = val;
        }
    });
}

let store = new Store();
store.data = 'Hi';
console.log(store.data) // Hi
```

### Object.definePropertyçš„å±€é™
- **`Object.defineProperty`åªèƒ½åŠ«æŒå¯¹è±¡çš„æŸä¸€ä¸ªå±æ€§**ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æœ‰åµŒå¥—çš„å¯¹è±¡æ—¶ï¼Œåªèƒ½é€šè¿‡é€šè¿‡é€’å½’å»ç»™æ¯ä¸€ä¸ªå±æ€§è®¾ç½®æ‹¦æˆª
- **`Object.defineProperty`å¹¶ä¸èƒ½åŠ«æŒ`Array.prototype`ä¸Šçš„æ–¹æ³•**ã€‚æ¯”å¦‚è¿˜æ˜¯ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œå½“`data`æ˜¯ä¸ªæ•°ç»„çš„æ—¶å€™ï¼Œå¯¹`data`è°ƒç”¨`push`ã€`pop`ç­‰æ•°ç»„åŸå‹ä¸Šçš„æ–¹æ³•çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šè§¦å‘`setter`:

```js
function Store() {
    let list = [];
    Object.defineProperty(this, 'list', {
        get: function() {
            console.log('æ‹¦æˆªåˆ°äº†ï¼Œä½ åœ¨è¯»å–æ•°æ®'); // æ‹¦æˆªåˆ°äº†ï¼Œä½ åœ¨è¯»å–æ•°æ®
            return list;
        },
        set: function(val) {
            console.log('âš ï¸pushæ“ä½œå¹¶æ²¡æœ‰è¢«æ‹¦æˆªåˆ°');
            list = val;
        }
    });
}

let store = new Store();
store.list.push(1);
console.log(store.list); // [1]
```

### å¦‚ä½•åŠ«æŒæ•°ç»„ä¸Šçš„æ–¹æ³•
æ—¢ç„¶setteré‡Œé¢æ‹¦æˆªä¸åˆ°åŸå‹é“¾ä¸Šçš„æ–¹æ³•ï¼Œé‚£å°±é’ˆå¯¹æ•°ç»„åŸå‹é“¾ä¸Šçš„éœ€è¦è¢«æ‹¦æˆªçš„æ–¹æ³•è¿›è¡ŒäºŒæ¬¡å°è£…ã€‚
```js
function newArrMethod() {
     // å…ˆæŠŠæ•°ç»„ä¸Šçš„æ–¹æ³•å¤åˆ¶ä¸€é
    let arrExtend = Object.create(Array.prototype);
    // ç„¶åæŠŠéœ€è¦æ”¹å†™çš„æ–¹æ³•é‡æ–°å°è£…ï¼Œæ¯”å¦‚ä¸‹é¢å¯¹pushæ–¹æ³•è¿›è¡Œé‡æ–°å°è£…
    let newPushMethod = function(...args) {
        console.log('åœ¨è¿™é‡Œåšæ‹¦æˆª');
        Array.prototype.push.apply(this, args);
    }
    arrExtend.push = newPushMethod; 
    return arrExtend;
}

let arr = [];
arr.__proto__ = newArrMethod();
arr.push(1); // arrçš„pushæ–¹æ³•è¢«åŠ«æŒåˆ°äº†
```

## Proxy
> `Proxy` å¯¹è±¡ç”¨äºå®šä¹‰åŸºæœ¬æ“ä½œçš„è‡ªå®šä¹‰è¡Œä¸ºï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ï¼Œèµ‹å€¼ï¼Œæšä¸¾ï¼Œå‡½æ•°è°ƒç”¨ç­‰ï¼‰

`Proxy`ï¼ˆ[MDNä¼ é€é—¨](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy)ï¼‰å­—é¢æ„æ€æ˜¯ä»£ç†ï¼Œå¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚ "æ‹¦æˆª"ï¼Œå½“å¤–ç•Œå¯¹è¯¥å¯¹è±¡è®¿é—®çš„æ—¶å€™ï¼Œéƒ½å¿…é¡»ç»è¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨è¿™ä¸ªapiå°±èƒ½å¤Ÿè¾¾åˆ°å¯¹è±¡åŠ«æŒçš„æ•ˆæœï¼Œ`vue2.*`ä¹‹æ‰€ä»¥ä¸ç”¨`Proxy`è€Œä½¿ç”¨`Object.defineProperty`æ˜¯å› ä¸º`Proxy`æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„ç‰¹æ€§ï¼Œè€ƒè™‘åˆ°æµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ï¼Œæ‰€ä»¥æ²¡æœ‰è¢«å°¤å¤§ä½¿ç”¨ã€‚åœ¨`vue3.0`å·²ç»æŠŠ`Object.defineProperty`æ›¿æ¢ä¸º`proxy`ï¼Œä¸‹é¢ä½¿ç”¨`proxy`æ¥å†™ä¸€ä¸ªåŠ«æŒğŸ‘‡
```js
let data = {};
data = new Proxy(data, {
    get: function(target, key) {
        console.log('æ‹¦æˆªåˆ°äº†ï¼Œä½ åœ¨è¯»å–æ•°æ®');
        return target[key];
    },
    set: function(target, key, val) {
        console.log('æ‹¦æˆªåˆ°äº†ï¼Œä½ åœ¨è®¾ç½®æ•°æ®');
        target[key] = val;
    }
})
data.name = 'å°æ˜';
console.log(data.name);
```

## å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼
Vue.jsé‡Œé¢çš„ä¾èµ–æ”¶é›†æ˜¯é€šè¿‡å‘å¸ƒ-è®¢é˜…æ¨¡å¼æ¥å®ç°çš„ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼åœ¨å‰ç«¯ç»å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚`document.addEventListener`å°±æ˜¯å¾ˆå…¸å‹å‘å¸ƒ-è®¢é˜…è€…åº”ç”¨ã€‚ä¸€èˆ¬æ¥è¯´å‘å¸ƒ-è®¢é˜…æ¨¡å¼æœ‰è¿™å‡ ä¸ªè¦ç´ ï¼š

- æœ‰ä¸€ä¸ªæŒ‡å®šçš„å‘å¸ƒè€…
- å‘å¸ƒè€…æœ‰ä¸€ä¸ªç¼“å­˜åˆ—è¡¨ï¼Œé‡Œé¢å­˜æœ‰æ‰€æœ‰è®¢é˜…è€…çš„å›è°ƒå‡½æ•°
- å‘å¸ƒæ¶ˆæ¯çš„æ—¶å€™ï¼Œå‘å¸ƒè€…éå†ç¼“å­˜åˆ—è¡¨ï¼Œä¾æ¬¡è§¦å‘è®¢é˜…è€…çš„å›è°ƒ

ğŸ‘‡ä¸‹é¢å®ç°ä¸€ä¸ªå…¸å‹çš„å‘å¸ƒè®¢é˜…è€…æ¨¡å¼
```js
class Event {
  constructor() {
    this.subscriberList = [];
  }
  listen(key, fn) {
    if (!this.subscriberList[key]) {
      this.subscriberList[key] = [];
    }
    this.subscriberList[key].push(fn);
  }
  notify() {
    let key = Array.prototype.shift.call(arguments);
    let fns = this.subscriberList[key];
    fns && fns.forEach(fn => fn.apply(this, arguments));
  }
  remove(key, fn) {
    let fns = this.subscriberList[key];
    if (fns) {
      for (let i = fns.length - 1; i >= 0; i--) {
        let _fn = fns[i];
        if (_fn == fn) {
          fns.splice(i, 1);
        }
      }
    }
  }
}
let event = new Event();
event.listen("sayHi", function(name) {
  console.log("Hiï¼Œ" + name);
});
event.listen("sayHallo", function(name) {
  console.log("Halloï¼Œ" + name);
});
event.notify("sayHi", "å°æ˜");
event.notify("sayHallo", "å°çº¢");
```
